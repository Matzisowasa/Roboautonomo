// --- GESTIÓN DE POTENCIA Y SENSORES ---

// Pines del driver BTS7960 (potencia del motor)
const int RPWM = 6;   // Señal PWM para avance
const int LPWM = 5;   // Señal PWM para reversa
const int R_EN = 4;   // Habilitación derecha (siempre HIGH)
const int L_EN = 2;   // Habilitación izquierda (siempre HIGH)

// Pines de sensores ultrasónicos HC-SR04
// Izquierda
const int TRIG_L = 9;
const int ECHO_L = 10;
// Derecha
const int TRIG_R = 11;
const int ECHO_R = 12;
// Delantero
const int TRIG_D = 7;
const int ECHO_D = 8;


// --- CONFIGURACIÓN INICIAL ---
void setupPotenciaYSensores() {
  // Driver BTS7960
  pinMode(RPWM, OUTPUT);
  pinMode(LPWM, OUTPUT);
  pinMode(R_EN, OUTPUT);
  pinMode(L_EN, OUTPUT);

  digitalWrite(R_EN, HIGH);   // Activar driver
  digitalWrite(L_EN, HIGH);

  // Sensores ultrasónicos
  pinMode(TRIG_L, OUTPUT);
  pinMode(ECHO_L, INPUT);

  pinMode(TRIG_R, OUTPUT);
  pinMode(ECHO_R, INPUT);

  pinMode(TRIG_D, OUTPUT);
  pinMode(ECHO_D, INPUT);
}

// --- LECTURA DE DISTANCIA ---
long leerUltrasonico(int trigPin, int echoPin) {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long duracion = pulseIn(echoPin, HIGH);
  long distancia = duracion * 0.034 / 2;  // Convertir a cm
  return distancia;
}


// --- CONTROL BÁSICO DE POTENCIA ---
void motorAvanzar(int velocidad) {
  analogWrite(RPWM, velocidad);
  analogWrite(LPWM, 0);
}

void motorDetener() {
  analogWrite(RPWM, 0);
  analogWrite(LPWM, 0);
}

void motorReversa(int velocidad) {
  analogWrite(RPWM, 0);
  analogWrite(LPWM, velocidad);
}
